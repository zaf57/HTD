<!DOCTYPE html>
<html>
<head>
    <title>HTD</title>
    <link rel="icon" type="image/x-icon" href="htd black.ico">
    <link rel="stylesheet" href="style.css">
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
</head>
<body>
	<div class="button-container-all">
        <div class="button-container">
            <button class="nav-button" onclick="afficherPage(1)">Hauteur</button>
            <button class="nav-button" onclick="afficherPage(2)">Douille</button>
            <button class="nav-button" onclick="afficherPage(3)">Entrer</button>
            <button class="nav-button" onclick="afficherPage(4)">Vessie</button>
            <button class="nav-button" onclick="afficherPage(5)">Conf.</button>
</div>
        </div>
    <h1></h1>

    <div id="page1">
        <!-- Le contenu de la premi√®re page -------------------------------------------------------------------------------------------------------------------------------------------------------->
                 <div class="logo-container">
        <img class="logo" src="htd black.png" alt="HTD"/>
     <h2>Hauteur Rolling:</h2>   
    </div>
      
      <label for="code-pneu">Code Rolling:</label>
        <input type="text" id="code-pneu" placeholder="Entrez valeur" onkeyup="afficherHauteur()" style="height: 40px;width: 160px;margin-left: 10px;margin-top: 40px;">
        
<br><br>

        <label for="hauteur-pneu">Hauteur Rolling:</label>
		<input type="text" id="hauteur-pneu" placeholder="..." readonly style="height: 40px;width: 160px;margin-bottom: 55px;margin-left: 10px;">
       
            <br><br>
      
      <!-- Clavier num√©rique -->
    <div id="numeric-keyboard">
        <!-- Ligne 1 -->
        <div class="numeric-row">
            <button class="numeric-button">1</button>
            <button class="numeric-button">2</button>
            <button class="numeric-button">3</button>
              </div>
        <!-- Ligne 2 -->
        <div class="numeric-row">
            <button class="numeric-button"style="margin-top: 3px;">4</button>
            <button class="numeric-button"style="margin-top: 3px;">5</button>
            <button class="numeric-button"style="margin-top: 3px;">6</button>
        </div>
        <!-- Ligne 3 -->
        <div class="numeric-row">
            <button class="numeric-button"style="margin-top: 3px;">7</button>
            <button class="numeric-button"style="margin-top: 3px;">8</button>
            <button class="numeric-button"style="margin-top: 3px;">9</button>
          </div>
        <!-- Ligne 4 -->
        <div class="numeric-row">
            <button class="numeric-button"style="margin-top: 3px;">0</button>
            <button id="clear-button" class="numeric-button"style="margin-top: 3px;">‚å´</button>
            
        </div>
    </div> 
<button id="voice-btn" title="Dicter le code" style="margin-left: 132px;
  margin-top: 23px;">üéôÔ∏è</button>
    </div>
  
<!-- Le contenu de la deuxi√®me page ------------------------------------------------------------------------------------------------------------------------------------------------------------>
                    <div id="page2" style="display: none;">
  <div class="logo-container">
    <img class="logo" src="htd black.png" alt="HTD"/>
    <h2>Calculer Douille:</h2>
  </div>

<!-- SECTION EXTENSION -->
<div class="carousel-container extension-carousel">
  <label for="extension-input">Extension:</label>
  <div class="carousel">
    <div class="carousel-display" id="extension-carousel">
      <img id="extension-image" src="480.png" alt="Extension" class="carousel-img extension-img">
      <div id="extension-value" class="carousel-value extension-value">480</div>
    </div>
    <div class="carousel-buttons extension-buttons" style="margin-left: 14px;">
      <button onclick="nextExtension()">‚ñ≤+10</button>
      <button onclick="prevExtension()">‚ñº-10</button>
    </div>
  </div>
</div>

<!-- SECTION GALBAGE -->
<div class="carousel-container galbage-carousel">
  <label for="galbage-input" style="margin-top: 46px;">Galbage:</label>
  <div class="carousel">
    <div class="carousel-display" id="galbage-carousel">
      <img id="galbage-image" src="280.png" alt="Galbage" class="carousel-img galbage-img">
      <div id="galbage-value" class="carousel-value galbage-value">280</div>
    </div>
    <div class="carousel-buttons galbage-buttons" style="margin-top: 38px;">
      <button onclick="nextGalbage()">‚ñ≤+5</button>
      <button onclick="prevGalbage()">‚ñº-5</button>
    </div>
  </div>
</div>


  <br><br>

<div class="switch-container">
  <span class="switch-label">Anneau JP:</span>
  <label class="switch">
    <input type="checkbox" id="jp-checkbox" onchange="calculerDouille()">
    <span class="slider"></span>
  </label>
	 <img src="https://github.com/zaf57/HTD/blob/main/douille.png?raw=true" alt="Image Douille" style="width: 100px; height: auto; margin-left: px;margin-top: 0px;">
</div>
  
  <div style="display: block;">
    <label for="douille-result">Douille:</label>
    <input type="text" id="douille-result" readonly style="height: 40px;width: 205px;font-size: 20px;text-align: center;margin-bottom: 11px;">
  </div>

  <br>
  
</div>

        <div id="page3" style="display: none;">
        <!-- Le contenu de la troisi√®me page ----------------------------------------------------------------------------------------------------------------------------------------------------------->
                      <div class="logo-container">
        <img class="logo" src="htd black.png" alt="HTD"/>
     <h2>Enregistrer Rolling:</h2>   
    </div>
  
		<form id="test-form" style="margin-top: 30px;">

<label for="code_pneu">Code Rolling:</label>
<input type="number" name="code_pneu" placeholder="Entrez valeur" id="code_pneu" class="numeric-input" style="height: 40px; width: 217px;"/>

<br /><br />

<label for="hauteur">Hauteur Rolling:</label>
<input type="number" name="hauteur" placeholder="Entrez valeur" id="hauteur" class="numeric-input" style="height: 40px; width: 160px;" />
			  
<select name="plus" id="plus" style="height: 52px; width: 52px;">
	    <option value="">‚Üï</option>
            <option value="+">+</option>
            <option value="?">?</option>
        </select>
      
    <br /><br />

    <button type="submit" id="submit-form" name="envoyer" style="margin-bottom: 61px;margin-top: 10px;">Envoyer</button>
  </form>
<img src="https://github.com/zaf57/HTD/blob/main/qr-code4.png?raw=true" alt="Image de votre choix" style="width: 150px; height: auto; margin-left: 107px;margin-top: 0px;border-radius: 6px;">
        <br><br>
    </div>


<div id="page4" style="display: none;">
	<!-- Le contenu de la 4eme page ----------------------------------------------------------------------------------------------------------------------------------------------------------->
  <div class="logo-container">
    <img class="logo" src="htd black.png" alt="HTD">
    <h2>Type Vessie:</h2>
  </div>

  <div id="table-container">Chargement des donn√©es...</div>

  <style>
    /* Style moderne pour le tableau */
    #table-container table {
      border-collapse: collapse;
      width: 100%;
      margin-top: 20px;
      background: black;
      box-shadow: 0 4px 8px rgba(0,0,0,0.1);
      font-family: Arial, sans-serif;
    }
    #table-container th, #table-container td {
      border: 1px solid #ddd;
      padding: 10px 15px;
      text-align: left;
    }
    #table-container th {
      background-color: #f5f5f5;
      font-weight: bold;
    }
    #table-container tr:hover {
      background-color: #f0f8ff;
    }
  </style>

  <script>
    const sheetCsvUrl =
      "https://docs.google.com/spreadsheets/d/1j0BOZy6Hkw_rMB2GxddEtl5wgxT8jbDuwkOfOoQFkbA/export?format=csv&gid=0";

    function parseCsvToArray(csvText) {
      const rows = csvText.trim().split("\n");
      return rows.map(row => row.split(",").map(cell => cell.trim()));
    }

    function buildHtmlTable(dataArray) {
      if (!dataArray || dataArray.length === 0) return "<p>Aucune donn√©e disponible.</p>";

      let html = "<table><thead><tr>";
      html += `<th>${dataArray[0][0] || ""}</th>`;
      html += `<th>${dataArray[0][1] || ""}</th>`;
      html += "</tr></thead><tbody>";

      for (let i = 1; i < dataArray.length; i++) {
        const row = dataArray[i];
        if (row.length >= 2) html += `<tr><td>${row[0]}</td><td>${row[1]}</td></tr>`;
      }

      html += "</tbody></table>";
      return html;
    }

    fetch(sheetCsvUrl)
      .then(res => res.text())
      .then(csv => {
        const data = parseCsvToArray(csv);
        document.getElementById("table-container").innerHTML = buildHtmlTable(data);
      })
      .catch(err => {
        console.error("Erreur :", err);
        document.getElementById("table-container").innerHTML = "<p>Erreur de chargement.</p>";
      });
  </script>
</div>

	
          <div id="page5" style="display: none;">
        <!-- Le contenu de la 5eme page ----------------------------------------------------------------------------------------------------------------------------------------------------------->
                      <div class="logo-container">
        <img class="logo" src="htd black.png" alt="HTD">
     <h2>Anneau de transfert:</h2>   
    </div>
  
		  <br /><br />
            <br /><br />
  600-650 (pas de cale)<br /><br />
  550-600 (cale nominale 25)<br /><br />
  525-575 (cale nominale 37.5)<br /><br />
  cale disponible: 0.5, 1, 1.5, 2

    
        <br /><br />


    </div>
  
    <br><br>
    
        <div id="message-banner" class="message-banner" style="display: none;">
            Enregistrement en cours...
    </div>
    
    <script src="https://apis.google.com/js/api.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jszip/3.6.0/jszip.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.16.9/xlsx.full.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/FileSaver.js/1.3.8/FileSaver.min.js"></script>
    <script type="text/javascript" src="https://code.jquery.com/jquery-3.4.1.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery-serialize-object/2.5.0/jquery.serialize-object.min.js" integrity="sha512-Gn0tSSjkIGAkaZQWjx3Ctl/0dVJuTmjW/f9QyB302kFjU4uTNP4HtA32U2qXs/TRlEsK5CoEqMEMs7LnzLOBsA==" crossorigin="anonymous" referrerpolicy="no-referrer"></script>
<script>
// Fonction pour afficher la quatri√®me page
    function afficherPage(pageNumber) {
		for(let i=1; i <=5; i++) {
		document.getElementById("page" + i).style.display=(i===pageNumber)? "block":"none";
	}
	}
	
	function afficherPage1() {
            document.getElementById("page1").style.display = "block";
            document.getElementById("page2").style.display = "none";
            document.getElementById("page3").style.display = "none";
            document.getElementById("page4").style.display = "none";
	        document.getElementById("page5").style.display = "none";
        }

         function afficherPage2() {
            document.getElementById("page1").style.display = "none";
            document.getElementById("page2").style.display = "block";
            document.getElementById("page3").style.display = "none";
            document.getElementById("page4").style.display = "none";
			document.getElementById("page5").style.display = "none";
        }

         function afficherPage3() {
            document.getElementById("page1").style.display = "none";
            document.getElementById("page2").style.display = "none";
            document.getElementById("page3").style.display = "block";
            document.getElementById("page4").style.display = "none";
			document.getElementById("page5").style.display = "none";
        }
          function afficherPage4() {
            document.getElementById("page1").style.display = "none";
            document.getElementById("page2").style.display = "none";
            document.getElementById("page3").style.display = "none";
            document.getElementById("page4").style.display = "block";
			document.getElementById("page5").style.display = "none";
        }
	     function afficherPage5() {
            document.getElementById("page1").style.display = "none";
            document.getElementById("page2").style.display = "none";
            document.getElementById("page3").style.display = "none";
            document.getElementById("page4").style.display = "none";
			document.getElementById("page5").style.display = "block";
        }
var correspondances = {};

function start() {
	const hauteurPneu = document.getElementById("hauteur-pneu");
    // Afficher le message de chargement directement dans la case
    hauteurPneu.value = "Chargement...";
             
	gapi.client.init({
                'apiKey': 'AIzaSyAIRpStG7VNS7XKpYmxunpO5hIsdZ_9d0E',
                'discoveryDocs': ['https://sheets.googleapis.com/$discovery/rest?version=v4'],
            }).then(function () {
                console.log('API initialized');
                chargerCorrespondances();
	        
				 // Une fois les donn√©es pr√™tes, afficher le üëç
        hauteurPneu.value = "Pr√™t"; 
        
				setTimeout(function() {
            afficherHauteur();
        }, 1000); // D√©lai de 1000 millisecondes
            }, function (error) {
                console.log('Error initializing API', error);
            });
        }
	
// Fonction pour charger les correspondances depuis Google Sheets
function chargerCorrespondances() {
       var fichier = "https://docs.google.com/spreadsheets/d/13Vf05H7GPCwWC-odB_EtnaHLWhdNwqWoBpEYrM2eIfA/export?format=xlsx";
       var requete = new XMLHttpRequest();

       requete.open("GET", fichier, true);
       requete.responseType = "arraybuffer";

       requete.onload = function () {
        var contenu = new Uint8Array(requete.response);
        var classeur = XLSX.read(contenu, { type: 'array' });

        var feuille = classeur.Sheets[classeur.SheetNames[0]];
        var donnees = XLSX.utils.sheet_to_json(feuille);

        correspondances = {};
        donnees.forEach(function (d) {
            correspondances[d.code_pneu] = {
                hauteur: d.hauteur,
                plus: d.plus // Assurez-vous que votre fichier Excel a une colonne "plus"
            };
        });
         //console.log(correspondances);
    };
requete.send();
}
	    
// Fonction pour obtenir le code pneu depuis Google Sheets et afficher la hauteur correspondante	    
function getCodePneu() {
    var codePneu = document.getElementById('code-pneu').value;
    gapi.client.sheets.spreadsheets.values.get({
        spreadsheetId: '13Vf05H7GPCwWC-odB_EtnaHLWhdNwqWoBpEYrM2eIfA',
        range: 'Feuille 1!A2:D', // Mettez √† jour la plage pour inclure la colonne "plus"
    }).then(function(response) {
        var values = response.result.values;
        var hauteurPneu = 'Non trouv√©';
        var plusValue = ''; // Ajoutez cette ligne pour r√©cup√©rer la valeur de la colonne "plus"
        
        if (values && values.length > 0) {
            for (var i = 0; i < values.length; i++) {
                var row = values[i];
                if (row[0] === codePneu) {
                    hauteurPneu = row[1];
                    plusValue = row[2]; // Mettez √† jour l'indice pour la colonne "plus"
                    break;
                }
            }
        }
         document.getElementById('hauteur-pneu').value = hauteurPneu + "  mm (plus: " + plusValue + ")";
    }, function(response) {
        console.log('Erreur : ' + response.result.error.message);
    });
}
	
// Fonction pour afficher la hauteur en fonction du code pneu saisi
function afficherHauteur() {
    var codePneu = document.getElementById("code-pneu").value;
    var hauteurPneu = document.getElementById("hauteur-pneu");

    if (correspondances.hasOwnProperty(codePneu)) {
        var hauteur = correspondances[codePneu].hauteur;
        var plus = correspondances[codePneu].plus;

        // Afficher la hauteur, la valeur de "plus" (si elle existe) et l'unit√© dans la m√™me case
        hauteurPneu.value = hauteur + (plus ? "" + plus : "") + " mm";
    } else {
        hauteurPneu.value = "";
    }
}
	    // Ajoutez un gestionnaire d'√©v√©nements pour les champs de classe "numeric-input"
$('.numeric-input').on('input', function() {
    // Remplacez le contenu pour autoriser uniquement les chiffres, "+" et "-"
    this.value = this.value.replace(/[^0-9+-]/g, '');
    if (!this.checkValidity()) {
        console.log('Valeur non valide');
    }
});
window.onload = function() {
          chargerCorrespondances();
            gapi.load('client', start);
        };  

//function Envoyer les donn√©es pour la page 3    
var $form = $('form#test-form'),
        url = 'https://script.google.com/macros/s/AKfycby34RasVRKyltXRHjD0bZA7IE1AXakPyhoHJQO7A_QoVP7jc8BvVJ_vythxySdRmv8/exec';

    $('#submit-form').on('click', function(e) {
      e.preventDefault();
      var jqxhr = $.ajax({
        url: url,
        method: "GET",
        dataType: "json",
        data: $form.serializeObject()
      }).done(function(response) {
                // R√©initialisez les valeurs des champs de saisie √† une cha√Æne vide
                // $('#code_pneu').val('');
                // $('#hauteur').val('');
	        // $('#plus').val('');
      });
            // Afficher la banni√®re pour indiquer l'enregistrement r√©ussi
            var messageBanner = document.getElementById("message-banner");
            messageBanner.style.display = "block";

            // Masquer la banni√®re apr√®s quelques secondes (par exemple, 3 secondes)
            setTimeout(function() {
            messageBanner.style.display = "none";
            }, 800); // 800 millisecondes (1 secondes)
   
    // R√©initialiser les champs apr√®s un d√©lai suppl√©mentaire (par exemple, 500 millisecondes) pour garantir une r√©initialisation plus rapide
    setTimeout(function() {
        $('#code_pneu').val('');
        $('#hauteur').val('');
        $('#plus').val('');
	$('#code_pneu').focus();
    }, 500); // 500 millisecondes
});

function s2ab(s) {
            var buf = new ArrayBuffer(s.length);
            var view = new Uint8Array(buf);
            for (var i = 0; i < s.length; i++) {
                view[i] = s.charCodeAt(i) & 0xFF;
            }
            return buf;
        }
//Fonction pour calculer la hauteur de la douille
        const extensionValues = [390, 400, 410, 420, 430, 440, 450, 460, 470, 480, 490];
        const galbageValues = [200, 205, 210, 215, 220, 225, 230, 235, 240, 245, 250, 255, 260, 265, 270, 275, 280, 285, 290, 295, 300, 305, 310, 315, 320, 325, 330];

        let extensionIndex = extensionValues.indexOf(480); // Index initial
        let galbageIndex = galbageValues.indexOf(280); // Index initial

        function updateExtension() {
  const val = extensionValues[extensionIndex];
  document.getElementById('extension-value').textContent = val;
  document.getElementById('extension-image').src = val + ".png";
  calculerDouille();
}

function updateGalbage() {
  const val = galbageValues[galbageIndex];
  document.getElementById('galbage-value').textContent = val;
  document.getElementById('galbage-image').src = val + ".png";
  calculerDouille();
}

        function prevExtension() {
            extensionIndex = (extensionIndex > 0) ? extensionIndex - 1 : extensionValues.length - 1;
            updateExtension();
        }

        function nextExtension() {
            extensionIndex = (extensionIndex < extensionValues.length - 1) ? extensionIndex + 1 : 0;
            updateExtension();
        }

        function prevGalbage() {
            galbageIndex = (galbageIndex > 0) ? galbageIndex - 1 : galbageValues.length - 1;
            updateGalbage();
        }

        function nextGalbage() {
            galbageIndex = (galbageIndex < galbageValues.length - 1) ? galbageIndex + 1 : 0;
            updateGalbage();
        }

        function calculerDouille() {
            var extensionValue = extensionValues[extensionIndex];
            var galbageValue = galbageValues[galbageIndex];
            var jpCheckbox = document.getElementById("jp-checkbox");
            var douilleResult = document.getElementById("douille-result");

            if (extensionValue - galbageValue > 205) {
                douilleResult.value = "‚ö† Augmenter Galbage!";
				douilleResult.style.color = "red";
            } else {
                var a = -1; // Coefficient de r√©gression lin√©aire pour extension
                var b = 1;  // Coefficient pour galbage
                var c = 535;  // Constante obtenue par r√©gression lin√©aire

                var douilleValue = (extensionValue * a) + (galbageValue * b) + c;

                if (jpCheckbox && jpCheckbox.checked) {
                    douilleValue -= 10;
                }

                douilleResult.value = douilleValue + " mm";
				douilleResult.style.color = "#ffa500";
            }
        }

    
    // Ajoutez cette ligne pour calculer la douille directement
    calculerDouille();

// Logique pour ajouter des gestionnaires d'√©v√©nements pour les boutons num√©riques et la touche "Effacer"
var numericButtons = document.querySelectorAll('.numeric-button');
var clearButton = document.getElementById('clear-button');
var codePneu = document.getElementById("code-pneu");
// Ajoutez un gestionnaire d'√©v√©nements clic √† chaque bouton num√©rique
numericButtons.forEach(function(button) {
    button.addEventListener('click', function() {
        var numericValue = button.textContent;
        codePneu.value += numericValue;
        afficherHauteur();
    });
});
// Ajoutez un gestionnaire d'√©v√©nements clic pour la touche "Effacer"
clearButton.addEventListener('click', function() {
    // R√©initialisez la valeur du champ "Code Rolling" √† une cha√Æne vide
    codePneu.value = "";
    afficherHauteur();
});
	// Initialisation
updateExtension();
updateGalbage();

//SWIPE CODE
  let currentPage = 1;
const totalPages = 5;

// Quand on change de page via les boutons existants :
function afficherPage(pageNumber) {
    for (let i = 1; i <= totalPages; i++) {
        document.getElementById("page" + i).style.display = (i === pageNumber) ? "block" : "none";
    }
    currentPage = pageNumber;
}

// Gestion du swipe tactile
let touchStartX = 0;
let touchEndX = 0;
const swipeThreshold = 50; // distance minimale du glissement

document.addEventListener('touchstart', function(e) {
    touchStartX = e.changedTouches[0].screenX;
}, false);

document.addEventListener('touchend', function(e) {
    touchEndX = e.changedTouches[0].screenX;
    handleSwipe();
}, false);

function handleSwipe() {
    const diff = touchEndX - touchStartX;

    if (Math.abs(diff) > swipeThreshold) {
        if (diff < 0) {
            // Swipe gauche ‚Üí page suivante
            if (currentPage < totalPages) {
                currentPage++;
                afficherPage(currentPage);
            }
        } else {
            // Swipe droite ‚Üí page pr√©c√©dente
            if (currentPage > 1) {
                currentPage--;
                afficherPage(currentPage);
            }
        }
    }
}

	//couleur bouton
  function afficherPage(pageNumber) {
    // Afficher la bonne page
    for (let i = 1; i <= totalPages; i++) {
        document.getElementById("page" + i).style.display = (i === pageNumber) ? "block" : "none";
    }

    // Mettre √† jour la page courante
    currentPage = pageNumber;

    // G√©rer la couleur active des boutons
    const buttons = document.querySelectorAll('.nav-button');
    buttons.forEach((btn, index) => {
        if (index + 1 === pageNumber) {
            btn.classList.add('active-button');
        } else {
            btn.classList.remove('active-button');
        }
    });
}

// --- Commande vocale pour le champ Code Rolling ---
const voiceBtn = document.getElementById("voice-btn");
const codeInput = document.getElementById("code-pneu");

if ("webkitSpeechRecognition" in window || "SpeechRecognition" in window) {
  const SpeechRecognition = window.SpeechRecognition || window.webkitSpeechRecognition;
  const recognition = new SpeechRecognition();
  recognition.lang = "fr-FR";
  recognition.continuous = false;
  recognition.interimResults = false;

  let isListening = false;

  voiceBtn.addEventListener("click", () => {
    if (!isListening) {
      recognition.start();
      isListening = true;
      voiceBtn.textContent = "üéôÔ∏è";
      voiceBtn.classList.add("listening"); // üî• ajoute l'effet clignotant
    }
  });

  recognition.onresult = (event) => {
    const result = event.results[0][0].transcript.trim();
    const cleanNumber = result.replace(/\D/g, "");

    if (cleanNumber) {
      codeInput.value = cleanNumber;
      afficherHauteur();
    } else {
      alert("Je n‚Äôai pas compris un nombre !");
    }

    resetMic();
  };

  recognition.onerror = () => {
    alert("Erreur : impossible d‚Äôutiliser le micro.");
    resetMic();
  };

  recognition.onend = () => {
    resetMic(); // üîß important pour Chrome quand aucun son n'est entendu
  };

  function resetMic() {
    voiceBtn.textContent = "üéôÔ∏è";
    voiceBtn.classList.remove("listening");
    isListening = false;
  }

} else {
  voiceBtn.disabled = true;
  voiceBtn.textContent = "‚ùå";
  voiceBtn.title = "Micro non support√© sur ce navigateur";
}


	
    </script>
</body>
</html>









































