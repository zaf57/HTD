<!DOCTYPE html>
<html>
<head>
    <title>HTD</title>
    <link rel="icon" type="image/x-icon" href="htd black.ico">
    <link rel="stylesheet" href="style.css">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <script src="https://apis.google.com/js/api.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jszip/3.6.0/jszip.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.16.9/xlsx.full.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/FileSaver.js/1.3.8/FileSaver.min.js"></script>
    <script type="text/javascript" src="https://code.jquery.com/jquery-3.4.1.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery-serialize-object/2.5.0/jquery.serialize-object.min.js" integrity="sha512-Gn0tSSjkIGAkaZQWjx3Ctl/0dVJuTmjW/f9QyB302kFjU4uTNP4HtA32U2qXs/TRlEsK5CoEqMEMs7LnzLOBsA==" crossorigin="anonymous" referrerpolicy="no-referrer"></script>
    
</head>
<body>
    <h1></h1>

    <div id="page1">
        <!-- Le contenu de la première page -------------------------------------------------------------------------------------------------------------------------------------------------------->
                 <div class="logo-container">
        <img class="logo" src="htd black.png" alt="HTD">
     <h2>Hauteur Rolling:</h2>   
    </div>
      
      <label for="code-pneu">Code Rolling:</label>
        <input type="text" id="code-pneu" placeholder="Entrez valeur" onkeyup="afficherHauteur()" style="height: 40px;width: 160px;margin-left: 10px;">
        
<br><br>

        <label for="hauteur-pneu">Hauteur Rolling:</label>
        <input type="text" id="hauteur-pneu" readonly="" style="height: 40px;width: 160px;margin-bottom: 55px;margin-left: 10px;">
       
            <br><br>
      
      <!-- Clavier numérique -->
    <div id="numeric-keyboard">
        <!-- Ligne 1 -->
        <div class="numeric-row">
            <button class="numeric-button">1</button>
            <button class="numeric-button">2</button>
            <button class="numeric-button">3</button>
              </div>
        <!-- Ligne 2 -->
        <div class="numeric-row">
            <button class="numeric-button"style="margin-top: 3px;">4</button>
            <button class="numeric-button"style="margin-top: 3px;">5</button>
            <button class="numeric-button"style="margin-top: 3px;">6</button>
        </div>
        <!-- Ligne 3 -->
        <div class="numeric-row">
            <button class="numeric-button"style="margin-top: 3px;">7</button>
            <button class="numeric-button"style="margin-top: 3px;">8</button>
            <button class="numeric-button"style="margin-top: 3px;">9</button>
          </div>
        <!-- Ligne 4 -->
        <div class="numeric-row">
            <button class="numeric-button"style="margin-top: 3px;">0</button>
            <button id="clear-button" class="numeric-button"style="margin-top: 3px;">⌫</button>
            
        </div>
    </div> 

    </div>
  
    <div id="page2" style="display: none;">
        <!-- Le contenu de la deuxième page ------------------------------------------------------------------------------------------------------------------------------------------------------------>
                    <div class="logo-container">
        <img class="logo" src="htd black.png" alt="HTD">
     <h2>Calculer Douille:</h2>   
    </div>
	    
	    <label for="extension-input">Extension:</label>
    <select id="extension-input" onchange="calculerDouille()" style="">
        <option value="490">490</option>
        <option value="480" selected="">480</option>
        <option value="470">470</option>
        <option value="460">460</option>
        <option value="450">450</option>
        <option value="440">440</option>
        <option value="430">430</option>
        <option value="420">420</option>
        <option value="410">410</option>
        <option value="400">400</option>
        <option value="390">390</option>
    </select>

    <br><br>

    <label for="galbage-input">Galbage:</label>
    <select id="galbage-input" onchange="calculerDouille()" style="">
        <option value="330">330</option>
        <option value="325">325</option>
        <option value="320">320</option>
        <option value="315">315</option>
        <option value="310">310</option>
        <option value="305">305</option>
        <option value="300">300</option>
        <option value="295">295</option>
        <option value="290">290</option>
        <option value="285">285</option>
        <option value="280" selected="">280</option>
        <option value="275">275</option>
        <option value="270">270</option>
        <option value="265">265</option>
        <option value="260">260</option>
        <option value="255">255</option>
        <option value="250">250</option>
        <option value="245">245</option>
        <option value="240">240</option>
        <option value="235">235</option>
        <option value="230">230</option>
        <option value="225">225</option>
        <option value="220">220</option>
        <option value="215">215</option>
        <option value="210">210</option>
        <option value="205">205</option>
        <option value="200">200</option>

    </select>
        <br><br>

        <div style="display: inline-block;">
            <label for="jp-checkbox">Anneau JP:</label>
            <input type="checkbox" id="jp-checkbox" class="jp-checkbox" onchange="calculerDouille()"style="margin-left: 7px;margin-bottom: 25px;margin-top: 15px;">
        </div>

        <div style="display: block;">
            <label for="douille-result">Douille:</label>
            <input type="text" id="douille-result" readonly style="height: 40px;width: 205px;font-size: 20px;text-align: center;margin-bottom: 51px;">
        </div>
        <br><br>
        <img src="https://github.com/zaf57/HTD/blob/main/douille.png?raw=true" alt="Image de votre choix" style="width: 100px; height: auto; margin-left: 131px;margin-top: 0px;">
    </div>

        <div id="page3" style="display: none;">
        <!-- Le contenu de la troisième page ----------------------------------------------------------------------------------------------------------------------------------------------------------->
                      <div class="logo-container">
        <img class="logo" src="htd black.png" alt="HTD">
     <h2>Enregistrer Rolling:</h2>   
    </div>
  
		<form id="test-form">

<label for="code_pneu">Code Rolling:</label>
<input type="number" name="code_pneu" placeholder="Entrez valeur" id="code_pneu" required pattern="[-+]?[0-9]+" class="numeric-input" style="height: 40px; width: 217px;"/>

<br /><br />

<label for="hauteur">Hauteur Rolling:</label>
<input type="number" name="hauteur" placeholder="Entrez valeur" id="hauteur" required pattern="[-+]?[0-9]+" class="numeric-input" style="height: 40px; width: 160px;" />
			  
<select name="plus" id="plus" style="height: 52px; width: 52px;">
	    <option value="">↕</option>
            <option value="+">+</option>
            <option value="?">?</option>
        </select>
      
    <br /><br />

    <button type="submit" id="submit-form" name="envoyer" style="margin-bottom: 60px;margin-top: 10px;">Envoyer</button>
  </form>
<img src="https://github.com/zaf57/HTD/blob/main/qr-code4.png?raw=true" alt="Image de votre choix" style="width: 150px; height: auto; margin-left: 107px;margin-top: 0px;border-radius: 6px;">
        <br><br>
    </div>

    <br><br>
    <div class="button-container-all">
        <div class="button-container">
            <button class="nav-button" onclick="afficherPage1()">./Hauteur</button>
            <button class="nav-button" onclick="afficherPage2()">./Douille</button>
            <button class="nav-button" onclick="afficherPage3()">./Enregistrer</button>
        </div>
        
        <div id="message-banner" class="message-banner" style="display: none;">
            Enregistrement en cours...
    </div>

    <script>
        function afficherPage1() {
            document.getElementById("page1").style.display = "block";
            document.getElementById("page2").style.display = "none";
            document.getElementById("page3").style.display = "none";
        }

        function afficherPage2() {
            document.getElementById("page1").style.display = "none";
            document.getElementById("page2").style.display = "block";
            document.getElementById("page3").style.display = "none";
        }

        function afficherPage3() {
            document.getElementById("page1").style.display = "none";
            document.getElementById("page2").style.display = "none";
            document.getElementById("page3").style.display = "block";
        }
        var correspondances = {};

        function start() {
            gapi.client.init({
                'apiKey': 'AIzaSyAIRpStG7VNS7XKpYmxunpO5hIsdZ_9d0E',
                'discoveryDocs': ['https://sheets.googleapis.com/$discovery/rest?version=v4'],
            }).then(function () {
                console.log('API initialized');
                chargerCorrespondances();
	// Ajoutez ici le code pour afficher "Prêt" dans la case hauteur-pneu
        document.getElementById("hauteur-pneu").value = "Prêt";
        setTimeout(function() {
            afficherHauteur();
        }, 10000); // Délai de 100 millisecondes
            }, function (error) {
                console.log('Error initializing API', error);
            });
        }

       function chargerCorrespondances() {
       var fichier = "https://docs.google.com/spreadsheets/d/13Vf05H7GPCwWC-odB_EtnaHLWhdNwqWoBpEYrM2eIfA/export?format=xlsx";
       var requete = new XMLHttpRequest();

       requete.open("GET", fichier, true);
       requete.responseType = "arraybuffer";

       requete.onload = function () {
        var contenu = new Uint8Array(requete.response);
        var classeur = XLSX.read(contenu, { type: 'array' });

        var feuille = classeur.Sheets[classeur.SheetNames[0]];
        var donnees = XLSX.utils.sheet_to_json(feuille);

        correspondances = {};
        donnees.forEach(function (d) {
            correspondances[d.code_pneu] = {
                hauteur: d.hauteur,
                plus: d.plus // Assurez-vous que votre fichier Excel a une colonne "plus"
            };
        });
         //console.log(correspondances);
    };
requete.send();
}
function getCodePneu() {
    var codePneu = document.getElementById('code-pneu').value;
    gapi.client.sheets.spreadsheets.values.get({
        spreadsheetId: '13Vf05H7GPCwWC-odB_EtnaHLWhdNwqWoBpEYrM2eIfA',
        range: 'Feuille 1!A2:D', // Mettez à jour la plage pour inclure la colonne "plus"
    }).then(function(response) {
        var values = response.result.values;
        var hauteurPneu = 'Non trouvé';
        var plusValue = ''; // Ajoutez cette ligne pour récupérer la valeur de la colonne "plus"
        
        if (values && values.length > 0) {
            for (var i = 0; i < values.length; i++) {
                var row = values[i];
                if (row[0] === codePneu) {
                    hauteurPneu = row[1];
                    plusValue = row[2]; // Mettez à jour l'indice pour la colonne "plus"
                    break;
                }
            }
        }
         document.getElementById('hauteur-pneu').value = hauteurPneu + "  mm (plus: " + plusValue + ")";
    }, function(response) {
        console.log('Erreur : ' + response.result.error.message);
    });
}

        function afficherHauteur() {
    var codePneu = document.getElementById("code-pneu").value;
    var hauteurPneu = document.getElementById("hauteur-pneu");

    if (correspondances.hasOwnProperty(codePneu)) {
        var hauteur = correspondances[codePneu].hauteur;
        var plus = correspondances[codePneu].plus;

        // Afficher la hauteur, la valeur de "plus" (si elle existe) et l'unité dans la même case
        hauteurPneu.value = hauteur + (plus ? "" + plus : "") + " mm";
    } else {
        hauteurPneu.value = "";
    }
}
	    // Ajoutez un gestionnaire d'événements pour les champs de classe "numeric-input"
$('.numeric-input').on('input', function() {
    // Remplacez le contenu pour autoriser uniquement les chiffres, "+" et "-"
    this.value = this.value.replace(/[^0-9+-]/g, '');
    if (!this.checkValidity()) {
        console.log('Valeur non valide');
    }
});
window.onload = function() {
          chargerCorrespondances();
            gapi.load('client', start);
        };  

       //function Envoyer page 3    
        var $form = $('form#test-form'),
        url = 'https://script.google.com/macros/s/AKfycby34RasVRKyltXRHjD0bZA7IE1AXakPyhoHJQO7A_QoVP7jc8BvVJ_vythxySdRmv8/exec';

    $('#submit-form').on('click', function(e) {
      e.preventDefault();
      var jqxhr = $.ajax({
        url: url,
        method: "GET",
        dataType: "json",
        data: $form.serializeObject()
      }).done(function(response) {
                // Réinitialisez les valeurs des champs de saisie à une chaîne vide
                $('#code_pneu').val('');
                $('#hauteur').val('');
	        $('#plus').val('');
      });
            // Afficher la bannière pour indiquer l'enregistrement réussi
            var messageBanner = document.getElementById("message-banner");
            messageBanner.style.display = "block";

            // Masquer la bannière après quelques secondes (par exemple, 3 secondes)
            setTimeout(function() {
            messageBanner.style.display = "none";
            }, 3000); // 3000 millisecondes (3 secondes)
    });

        function s2ab(s) {
            var buf = new ArrayBuffer(s.length);
            var view = new Uint8Array(buf);
            for (var i = 0; i < s.length; i++) {
                view[i] = s.charCodeAt(i) & 0xFF;
            }
            return buf;
        }
        function calculerDouille() {
            var extensionValue = parseInt(document.getElementById("extension-input").value);
            var galbageValue = parseInt(document.getElementById("galbage-input").value);
            var jpCheckbox = document.getElementById("jp-checkbox");
            var douilleResult = document.getElementById("douille-result");

            // Vérifier que la différence entre l'extension et le galbage est supérieure ou égale à 200
            if (extensionValue - galbageValue > 200) {
                douilleResult.value = "⚠ Augmenter Galbage!";
            } else {
                // Définir les coefficients a, b et c obtenus à partir de la régression linéaire
                var a = -1; // Remplacez par les coefficients réels que vous avez trouvés
                var b = 1;  // Remplacez par les coefficients réels que vous avez trouvés
                var c = 535;  // Remplacez par les coefficients réels que vous avez trouvés

                // Calculez la douille en utilisant l'équation linéaire : D = (E * a) + (G * b) + c
                var douilleValue = (extensionValue * a) + (galbageValue * b) + c;

                // Réduisez la douille de 10 si la case JP est cochée
                if (jpCheckbox.checked) {
                    douilleValue -= 10;
                }

                douilleResult.value = douilleValue + "  mm";
            }
        }
	    function afficherPage2() {
    document.getElementById("page1").style.display = "none";
    document.getElementById("page2").style.display = "block";
    document.getElementById("page3").style.display = "none";
    
    // Ajoutez cette ligne pour calculer la douille directement
    calculerDouille();
}
// Récupérez tous les boutons numériques et la touche "Effacer"
var numericButtons = document.querySelectorAll('.numeric-button');
var clearButton = document.getElementById('clear-button');
var codePneu = document.getElementById("code-pneu");
// Ajoutez un gestionnaire d'événements clic à chaque bouton numérique
numericButtons.forEach(function(button) {
    button.addEventListener('click', function() {
        var numericValue = button.textContent;
        codePneu.value += numericValue;
        afficherHauteur();
    });
});
// Ajoutez un gestionnaire d'événements clic pour la touche "Effacer"
clearButton.addEventListener('click', function() {
    // Réinitialisez la valeur du champ "Code Rolling" à une chaîne vide
    codePneu.value = "";
    afficherHauteur();
});
    </script>
</body>
</html>
